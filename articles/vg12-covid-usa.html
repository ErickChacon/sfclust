<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Covid-19 in US states during 2020 â€¢ sfclust</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Covid-19 in US states during 2020">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sfclust</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/vg01-get-started.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/vg02-additional-features.html">Additional features</a></li>
    <li><a class="dropdown-item" href="../articles/vg03-stars-object.html">Create stars dataset</a></li>
    <li><a class="dropdown-item" href="../articles/vg12-covid-usa.html">Covid-19 in US states during 2020</a></li>
    <li><a class="dropdown-item" href="../articles/vg14-temp-canada.html">Daily temperature at Canada stations</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Covid-19 in US states during 2020</h1>
            
      

      <div class="d-none name"><code>vg12-covid-usa.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we use <code>sfclust</code> to identify US states
with similar relative risk of Covid-19 during 2020.</p>
<div class="section level2">
<h2 id="load-packages-and-data">Load packages and data<a class="anchor" aria-label="anchor" href="#load-packages-and-data"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">sfclust</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: abind</span></span>
<span><span class="co">#&gt; Loading required package: sf</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.4.0; sf_use_s2() is TRUE</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<p>The data for this application can be found at our github repository:
<a href="https://github.com/ErickChacon/sfclust/blob/main/tools/data/usacovid.rds" class="external-link">https://github.com/ErickChacon/sfclust/blob/main/tools/data/usacovid.rds</a>.
This data contains the weekly information of the number of
<code>cases</code>, the <code>population</code> size and the number of
<code>expected</code> cases for 49 states.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usacovid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"tools"</span>, <span class="st">"data"</span>, <span class="st">"usacovid.rds"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">usacovid</span></span>
<span><span class="co">#&gt; stars object with 2 dimensions and 3 attributes</span></span>
<span><span class="co">#&gt; attribute(s):</span></span>
<span><span class="co">#&gt;                     Min.      1st Qu.       Median         Mean     3rd Qu.</span></span>
<span><span class="co">#&gt; cases             0.0000      387.000     2921.000     8862.738     8653.00</span></span>
<span><span class="co">#&gt; population  4072852.0000 13333320.000 32645312.000 45820355.000 51060352.00</span></span>
<span><span class="co">#&gt; expected        175.6667     2934.647     6013.216     8862.738    11052.02</span></span>
<span><span class="co">#&gt;                     Max.</span></span>
<span><span class="co">#&gt; cases          316910.00</span></span>
<span><span class="co">#&gt; population  274041320.00</span></span>
<span><span class="co">#&gt; expected        55213.08</span></span>
<span><span class="co">#&gt; dimension(s):</span></span>
<span><span class="co">#&gt;       from to     offset  delta refsys point</span></span>
<span><span class="co">#&gt; time     1 51 2020-01-20 7 days   Date FALSE</span></span>
<span><span class="co">#&gt; space    1 49         NA     NA WGS 84 FALSE</span></span>
<span><span class="co">#&gt;                                                              values</span></span>
<span><span class="co">#&gt; time                                                           NULL</span></span>
<span><span class="co">#&gt; space MULTIPOLYGON (((-88.05338...,...,MULTIPOLYGON (((-111.0467...</span></span></code></pre></div>
<p>Notice that the dimensions names are <code>space</code> and
<code>time</code>, take that in mind because <code>sfclust</code>
assumes that the dimension names are <code>c("geometry", "time")</code>,
so you will need to provide the dimension names when using
<code>sfclust</code>.</p>
</div>
<div class="section level2">
<h2 id="exploratory-analysis">Exploratory analysis<a class="anchor" aria-label="anchor" href="#exploratory-analysis"></a>
</h2>
<p>We can visualize the weekly Covid-19 relative risk across 49 states.
It shows higher levels of risk by the end of the year.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/stars/reference/geom_stars.html" class="external-link">geom_stars</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">cases</span><span class="op">/</span><span class="va">expected</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">usacovid</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">time</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"RdBu"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Relative risk"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vg12-covid-usa_files/figure-html/unnamed-chunk-3-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>Similarly we can observe the relative risk time series per state. It
shows some peak around April, July and a big peak in December.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usacovid</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_dimensions.html" class="external-link">st_set_dimensions</a></span><span class="op">(</span><span class="st">"space"</span>, values <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">usacovid</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">cases</span><span class="op">/</span><span class="va">expected</span>, group <span class="op">=</span> <span class="va">space</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">space</span><span class="op">)</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">cases</span><span class="op">/</span><span class="va">expected</span>, group <span class="op">=</span> <span class="va">space</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">space</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Relative risk"</span>, x <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vg12-covid-usa_files/figure-html/unnamed-chunk-4-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="spatial-clustering">Spatial clustering<a class="anchor" aria-label="anchor" href="#spatial-clustering"></a>
</h2>
<div class="section level3">
<h3 id="model-fitting">Model fitting<a class="anchor" aria-label="anchor" href="#model-fitting"></a>
</h3>
<p>In this application, because of the trends observed before, we will
assume that the logarithm relative risk can be explained by (i) a
polynomial trend with respect to <code>time</code>, (ii) an
autoregressive process over times units <code>idt</code> to capture
correlated temporal variation, and (iii) an additional unstructured
effect over <code>id</code> to capture any residual variation.
Additionally, we will start assuming that each state is a cluster, such
us we will start with 49 clusters. Also remember that in this case we
need to provide the dimension names <code>stnames</code> as explained
before.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="va">cases</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">time</span>, <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fu">f</span><span class="op">(</span><span class="va">idt</span>, model <span class="op">=</span> <span class="st">"ar1"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">f</span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span><span class="va">geodata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genclust.html">genclust</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">usacovid</span><span class="op">)</span>, nclust <span class="op">=</span> <span class="fl">49</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sfclust.html">sfclust</a></span><span class="op">(</span><span class="va">usacovid</span>, graphdata <span class="op">=</span> <span class="va">geodata</span>, stnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"space"</span>, <span class="st">"time"</span><span class="op">)</span>,</span>
<span>    formula <span class="op">=</span> <span class="va">formula</span>, family <span class="op">=</span> <span class="st">"poisson"</span>, E <span class="op">=</span> <span class="va">expected</span>,</span>
<span>    niter <span class="op">=</span> <span class="fl">4000</span>, burnin <span class="op">=</span> <span class="fl">0</span>, thin <span class="op">=</span> <span class="fl">10</span>, nmessage <span class="op">=</span> <span class="fl">10</span>, nsave <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    path_save <span class="op">=</span> <span class="st">"usacovid-mcmc.rds"</span><span class="op">)</span></span>
<span><span class="va">result</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Within-cluster formula:</span></span>
<span><span class="co">#&gt; cases ~ 1 + poly(time, 3) + f(idt, model = "ar1") + f(id)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Clustering hyperparameters:</span></span>
<span><span class="co">#&gt;   log(1-q)      birth      death     change      hyper </span></span>
<span><span class="co">#&gt; -0.6931472  0.4250000  0.4250000  0.1000000  0.0500000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Clustering movement counts:</span></span>
<span><span class="co">#&gt;  births  deaths changes  hypers </span></span>
<span><span class="co">#&gt;      36      74      12     187 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Log marginal likelihood (sample 400 out of 400): -19196.71</span></span></code></pre>
<p>Notice that 36 times there was an increase of number of clusters, 74
times clusters were merged, 12 times the composition were modified, and
187 time the minimum spanning tree has been modified. Also after
thinning we keep 400 samples from a total of 4000, and the marginal
likelihood achieve a value of -19196.77.</p>
</div>
<div class="section level3">
<h3 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Summary for clustering sample 400 out of 400 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Within-cluster formula:</span></span>
<span><span class="co">#&gt; cases ~ 1 + poly(time, 3) + f(idt, model = "ar1") + f(id)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Counts per cluster:</span></span>
<span><span class="co">#&gt;  1  2  3  4  5  6  7  8  9 10 11 </span></span>
<span><span class="co">#&gt; 10  9  8  6  5  4  3  1  1  1  1 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Log marginal likelihood:  -19196.71</span></span></code></pre></div>
<p>The <code>summary</code> indicates that 7 clusters from 11 have more
than one member, where the biggest cluster includes 10 states, the
second 9, and so on.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span>, legend <span class="op">=</span> <span class="cn">TRUE</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="vg12-covid-usa_files/figure-html/unnamed-chunk-9-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>The <code>plot</code> of our result indicates that:</p>
<ul>
<li>The biggest cluster is located in the southwest of US, followed by a
second cluster in the middle, and a third cluster on the northwest.</li>
<li>The mean relative risk per cluster has low value at the beginning of
the year and higher values by the end of the year, which is related to
the empirical risk observed.</li>
<li>The algorithm increases the marginal likelihood in the first 100
samples (after thinning), and then is almost constant by sample
200.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">us_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">result</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">us_fit</span></span>
<span><span class="co">#&gt; stars object with 2 dimensions and 9 attributes</span></span>
<span><span class="co">#&gt; attribute(s):</span></span>
<span><span class="co">#&gt;                        Min.       1st Qu.        Median          Mean</span></span>
<span><span class="co">#&gt; mean          -18.756909955 -1.849076e+00 -6.834142e-01 -2.124749e+00</span></span>
<span><span class="co">#&gt; sd              0.001776338  1.074621e-02  1.849090e-02  1.442848e-01</span></span>
<span><span class="co">#&gt; 0.025quant    -21.774831846 -1.940976e+00 -7.270388e-01 -2.411716e+00</span></span>
<span><span class="co">#&gt; 0.5quant      -18.743482749 -1.849076e+00 -6.834142e-01 -2.123470e+00</span></span>
<span><span class="co">#&gt; 0.975quant    -15.814701821 -1.749546e+00 -6.387514e-01 -1.845001e+00</span></span>
<span><span class="co">#&gt; mode          -18.743328395 -1.849076e+00 -6.834142e-01 -2.123175e+00</span></span>
<span><span class="co">#&gt; kld             0.000000000  5.513189e-11  5.526687e-11  5.639992e-09</span></span>
<span><span class="co">#&gt; mean_cluster  -18.756875140 -1.760756e+00 -6.846120e-01 -2.125807e+00</span></span>
<span><span class="co">#&gt; cluster         1.000000000  2.000000e+00  3.000000e+00  3.755102e+00</span></span>
<span><span class="co">#&gt;                    3rd Qu.         Max.</span></span>
<span><span class="co">#&gt; mean          2.489176e-01 1.898851e+00</span></span>
<span><span class="co">#&gt; sd            5.030386e-02 1.847165e+00</span></span>
<span><span class="co">#&gt; 0.025quant    2.254256e-01 1.841667e+00</span></span>
<span><span class="co">#&gt; 0.5quant      2.489176e-01 1.898851e+00</span></span>
<span><span class="co">#&gt; 0.975quant    2.762781e-01 1.956034e+00</span></span>
<span><span class="co">#&gt; mode          2.489176e-01 1.898851e+00</span></span>
<span><span class="co">#&gt; kld           5.556921e-11 3.198865e-07</span></span>
<span><span class="co">#&gt; mean_cluster  1.504234e-01 1.634518e+00</span></span>
<span><span class="co">#&gt; cluster       5.000000e+00 1.100000e+01</span></span>
<span><span class="co">#&gt; dimension(s):</span></span>
<span><span class="co">#&gt;       from to     offset  delta refsys point</span></span>
<span><span class="co">#&gt; time     1 51 2020-01-20 7 days   Date FALSE</span></span>
<span><span class="co">#&gt; space    1 49         NA     NA WGS 84 FALSE</span></span>
<span><span class="co">#&gt;                                                              values</span></span>
<span><span class="co">#&gt; time                                                           NULL</span></span>
<span><span class="co">#&gt; space MULTIPOLYGON (((-88.05338...,...,MULTIPOLYGON (((-111.0467...</span></span></code></pre></div>
<p>The <code>fitted</code> function return an <code>stars</code> object
with prediction summaries after fitting, the <code>cluster</code>
assignment and the <code>mean_cluster</code>.</p>
</div>
<div class="section level3">
<h3 id="empirical-risk-per-cluster">Empirical risk per cluster<a class="anchor" aria-label="anchor" href="#empirical-risk-per-cluster"></a>
</h3>
<p>We can use that information of the cluster assignment to visualize
the empirical data per cluster.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usacovid</span><span class="op">$</span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="va">us_fit</span><span class="op">$</span><span class="va">cluster</span></span>
<span></span>
<span><span class="co"># convert stars to data frame per region and per cluster</span></span>
<span><span class="va">usaaux</span> <span class="op">&lt;-</span> <span class="va">usacovid</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_dimensions.html" class="external-link">st_set_dimensions</a></span><span class="op">(</span><span class="st">"space"</span>, values <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">usacovid</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">usacluster</span> <span class="op">&lt;-</span> <span class="va">usaaux</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">cluster</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>rr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cases</span><span class="op">/</span><span class="va">expected</span><span class="op">)</span> <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'time'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span></span>
<span><span class="co"># visualize empirical risk per cluster</span></span>
<span><span class="va">usaaux</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">cases</span><span class="op">/</span><span class="va">expected</span>, group <span class="op">=</span> <span class="va">space</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray50"</span>, linewidth <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">rr</span><span class="op">)</span>, <span class="va">usacluster</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">cluster</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Relative risk"</span>, x <span class="op">=</span> <span class="st">"Time"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vg12-covid-usa_files/figure-html/unnamed-chunk-12-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>The graph above shows the empirical risk per cluster. We can see that
the biggest cluster has a increasing risk with a peak around
July-August, while the second has a increasing trend until
November-December with a decay by end of December. The third cluster has
a bigger peak around March and later a higher risk by January. Similar
particularities can be seen for cluster 4-7, while cluster 8-11 have
more uncommon behaviour than the others.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Erick A. ChacÃ³n-MontalvÃ¡n, Ruiman Zhong, Paula Moraga.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
