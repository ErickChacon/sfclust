<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Bayesian spatial functional clustering — sfclust • sfclust</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian spatial functional clustering — sfclust"><meta property="og:description" content="Bayesian detection of neighboring spatial regions with similar functional shapes using
spanning trees and latent Gaussian models. It ensures spatial contiguity in the
clusters, handles a large family of latent Gaussian models supported by inla, and
allows to work with non-Gaussian likelihoods."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sfclust</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/additional-features.html">Additional features</a>
    </li>
    <li>
      <a href="../articles/get-started.html">Getting started</a>
    </li>
    <li>
      <a href="../articles/stars-object.html">Create stars dataset</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Bayesian spatial functional clustering</h1>

    <div class="hidden name"><code>sfclust.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Bayesian detection of neighboring spatial regions with similar functional shapes using
spanning trees and latent Gaussian models. It ensures spatial contiguity in the
clusters, handles a large family of latent Gaussian models supported by <code>inla</code>, and
allows to work with non-Gaussian likelihoods.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sfclust</span><span class="op">(</span></span>
<span>  <span class="va">stdata</span>,</span>
<span>  graphdata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"geometry"</span>, <span class="st">"time"</span><span class="op">)</span>,</span>
<span>  move_prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.425</span>, <span class="fl">0.425</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  q <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  correction <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  niter <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  burnin <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  thin <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  nmessage <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  path_save <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nsave <span class="op">=</span> <span class="va">nmessage</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-stdata">stdata<a class="anchor" aria-label="anchor" href="#arg-stdata"></a></dt>
<dd><p>A stars object containing response variables, covariates, and other necessary data.</p></dd>


<dt id="arg-graphdata">graphdata<a class="anchor" aria-label="anchor" href="#arg-graphdata"></a></dt>
<dd><p>A list containing the initial graph used for the Bayesian model.
It should include components like <code>graph</code>, <code>mst</code>, and <code>membership</code> (default is <code>NULL</code>).</p></dd>


<dt id="arg-stnames">stnames<a class="anchor" aria-label="anchor" href="#arg-stnames"></a></dt>
<dd><p>A character vector specifying the spatio-temporal dimension names of
<code>stdata</code> that represent spatial geometry and time, respectively (default is
<code>c("geometry", "time")</code>).</p></dd>


<dt id="arg-move-prob">move_prob<a class="anchor" aria-label="anchor" href="#arg-move-prob"></a></dt>
<dd><p>A numeric vector of probabilities for different types of moves in the MCMC process:
birth, death, change, and hyperparameter moves (default is <code>c(0.425, 0.425, 0.1, 0.05)</code>).</p></dd>


<dt id="arg-q">q<a class="anchor" aria-label="anchor" href="#arg-q"></a></dt>
<dd><p>A numeric value representing the penalty for the number of clusters (default is <code>0.5</code>).</p></dd>


<dt id="arg-correction">correction<a class="anchor" aria-label="anchor" href="#arg-correction"></a></dt>
<dd><p>A logical indicating whether correction to compute the marginal
likelihoods should be applied (default is <code>TRUE</code>). This depend of the type of
effect inclused in the <code>INLA</code> model.</p></dd>


<dt id="arg-niter">niter<a class="anchor" aria-label="anchor" href="#arg-niter"></a></dt>
<dd><p>An integer specifying the number of MCMC iterations to perform (default is <code>100</code>).</p></dd>


<dt id="arg-burnin">burnin<a class="anchor" aria-label="anchor" href="#arg-burnin"></a></dt>
<dd><p>An integer specifying the number of burn-in iterations to discard (default is <code>0</code>).</p></dd>


<dt id="arg-thin">thin<a class="anchor" aria-label="anchor" href="#arg-thin"></a></dt>
<dd><p>An integer specifying the thinning interval for recording the results (default is <code>1</code>).</p></dd>


<dt id="arg-nmessage">nmessage<a class="anchor" aria-label="anchor" href="#arg-nmessage"></a></dt>
<dd><p>An integer specifying how often progress messages should be printed (default is <code>10</code>).</p></dd>


<dt id="arg-path-save">path_save<a class="anchor" aria-label="anchor" href="#arg-path-save"></a></dt>
<dd><p>A character string specifying the file path to save the results (default is <code>NULL</code>).</p></dd>


<dt id="arg-nsave">nsave<a class="anchor" aria-label="anchor" href="#arg-nsave"></a></dt>
<dd><p>An integer specifying the number of iterations between saved results in the chain
(default is <code>nmessage</code>).</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments such as <code>formula</code>, <code>family</code>, and others that are passed
to the <code>inla</code> function.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>An <code>sfclust</code> object containing two main lists: <code>samples</code> and <code>clust</code>.</p><ul><li><p>The <code>samples</code> list includes details from the sampling process, such as:</p><ul><li><p><code>membership</code>: The cluster membership assignments for each sample.</p></li>
<li><p><code>log_marginal_likelihood</code>: The log marginal likelihood for each sample.</p></li>
<li><p><code>move_counts</code>: The counts of each type of move during the MCMC process.</p></li>
</ul></li>
<li><p>The <code>clust</code> list contains information about the selected clustering, including:</p><ul><li><p><code>id</code>: The identifier of the selected sample (default is the last sample).</p></li>
<li><p><code>membership</code>: The cluster assignments for the selected sample.</p></li>
<li><p><code>models</code>: The fitted models for each cluster in the selected sample.</p></li>
</ul></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p>This implementation draws inspiration from the methods described in the paper:
<em>"Bayesian Clustering of Spatial Functional Data with Application to a Human Mobility
Study During COVID-19"</em> by Bohai Zhang, Huiyan Sang, Zhao Tang Luo, and Hui Huang,
published in <em>The Annals of Applied Statistics</em>, 2023. For further details on the
methodology, please refer to:</p><ul><li><p>The paper: <a href="https://doi.org/10.1214/22-AOAS1643" class="external-link">doi:10.1214/22-AOAS1643</a></p></li>
<li><p>Supplementary material: <a href="https://doi.org/10.1214/22-AOAS1643SUPPB" class="external-link">doi:10.1214/22-AOAS1643SUPPB</a></p></li>
</ul><p>The MCMC algorithm in this implementation is largely based on the supplementary
material provided in the paper. However, we have generalized the computation of the
marginal likelihood ratio by leveraging INLA (Integrated Nested Laplace Approximation).
This generalization enables integration over all parameters and hyperparameters,
allowing for inference within a broader family of distribution functions and model
terms, thereby extending the scope and flexibility of the original approach.
Further details of our approach can be found in our paper <em>"Bayesian spatial functional
data clustering: applications in disease surveillance"</em> by Ruiman Zhong, Erick A.
Chacón-Montalván, Paula Moraga:</p><ul><li><p>The paper: <a href="https://arxiv.org/abs/2407.12633" class="external-link">https://arxiv.org/abs/2407.12633</a></p></li>
</ul></div>
    <div id="author">
    <h2>Author</h2>
    <p>Ruiman Zhong <a href="mailto:ruiman.zhong@kaust.edu.sa">ruiman.zhong@kaust.edu.sa</a>,
Erick A. Chacón-Montalván <a href="mailto:erick.chaconmontalvan@kaust.edu.sa">erick.chaconmontalvan@kaust.edu.sa</a>,
Paula Moraga <a href="mailto:paula.moraga@kaust.edu.sa">paula.moraga@kaust.edu.sa</a></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Gaussian model</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">sfclust</span><span class="op">(</span><span class="va">stdata</span>, formula <span class="op">=</span> <span class="va">cases</span> <span class="op">~</span> <span class="va">temperature</span>, niter <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Poisson model</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">sfclust</span><span class="op">(</span><span class="va">stdata</span>, formula <span class="op">=</span> <span class="va">cases</span> <span class="op">~</span> <span class="va">temperature</span> <span class="op">+</span> <span class="fu">f</span><span class="op">(</span><span class="va">id</span>, model <span class="op">=</span> <span class="st">'iid'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    family <span class="op">=</span> <span class="st">"poisson"</span>, E <span class="op">=</span> <span class="va">expected</span>, niter <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Erick A. Chacón-Montalván, Ruiman Zhong, Paula Moraga.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

      </footer></div>






  </body></html>

